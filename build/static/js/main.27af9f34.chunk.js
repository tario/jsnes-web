(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{35:function(e,t,n){e.exports=n(64)},47:function(e,t,n){},49:function(e,t,n){},57:function(e,t,n){},59:function(e,t,n){},62:function(e,t,n){},64:function(e,t,n){"use strict";n.r(t);var a=n(14),o=n.n(a),r=n(1),s=n.n(r),i=n(15),l=n.n(i),c=n(4),u=n(6),p=n(9),m=n(8),h=n(10),d=n(24),f=n(66),g=n(67),b=(n(47),n(7)),y=n(65),v={ROMS:{"Bubble Bobble":"https://cors-anywhere.herokuapp.com/http://theromdepot.com/roms/NES/US/Bubble%20Bobble%20(U).nes",Castlevania:"https://cors-anywhere.herokuapp.com/http://theromdepot.com/roms/NES/US/Castlevania%20(U).nes",Contra:"https://cors-anywhere.herokuapp.com/http://theromdepot.com/roms/NES/US/Contra%20(U).nes","Donkey Kong Classics":"https://cors-anywhere.herokuapp.com/http://theromdepot.com/roms/NES/US/Donkey%20Kong%20Classics%20(U).nes","Duck Hunt":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Duck%20Hunt%20(JUE).nes","Final Fantasy":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Final%20Fantasy%20(U).nes",Golf:"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Golf%20(JU).nes","Kirby's Adventure":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Kirby's%20Adventure%20(U).nes","The Legend of Zelda":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Legend%20of%20Zelda,%20The%20(Rev%201)%20(U).nes",Lemmings:"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Lemmings%20(U).nes",Lifeforce:"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Lifeforce%20(U).nes","Mario Bros.":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Mario%20Bros%20(JU).nes","Mega Man":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Mega%20Man%20(U).nes","Metal Gear":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Metal%20Gear%20(U).nes",Metroid:"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Metroid%20(U).nes","Pac-Man":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Pac-Man%20(U).nes","Super Mario Bros.":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Super%20Mario%20Bros%20(Rev%201)%20(JU).nes","Super Mario Bros. 2":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Super%20Mario%20Bros%202%20(Rev%201)%20(U).nes","Super Mario Bros. 3":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Super%20Mario%20Bros%203%20(Rev%201)%20(U).nes","Tecmo Super Bowl":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Tecmo%20Super%20Bowl%20(U).nes","Teenage Mutant Ninja Turtles II":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Teenage%20Mutant%20Ninja%20Turtles%202%20(U).nes",Tennis:"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Tennis%20(JU).nes",Tetris:"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Tetris%20(U).nes","Tetris 2":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Tetris%202%20(U).nes","Zelda 2":"https://cors-anywhere.herokuapp.com/http://www.vertigofx.com/public/games/roms/nes/Zelda%202%20-%20The%20Adventure%20of%20Link%20(U).nes"},GOOGLE_ANALYTICS_CODE:Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_GOOGLE_ANALYTICS_CODE,SENTRY_URI:Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_SENTRY_URI},w=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).handleDragOver=function(e){e.preventDefault(),e.dataTransfer.dropEffect="copy"},n.handleDrop=function(e){e.preventDefault();var t=e.dataTransfer.items?e.dataTransfer.items[0].getAsFile():e.dataTransfer.files[0];n.props.history.push({pathname:"/run",state:{file:t}})},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"container ListPage my-4",onDragOver:this.handleDragOver,onDrop:this.handleDrop},s.a.createElement("div",{className:"row justify-content-center"},s.a.createElement("div",{className:"col-md-8"},s.a.createElement("header",{className:"mb-4"},s.a.createElement("h1",{className:"mb-3"},"JSNES"),s.a.createElement("p",null,"A JavaScript NES emulator."),s.a.createElement("p",null,"By ",s.a.createElement("a",{href:"https://twitter.com/bfirsh"},"Ben Firshman"),". Source on ",s.a.createElement("a",{href:"https://github.com/bfirsh/jsnes"},"GitHub"),".")),s.a.createElement(b.b,{className:"mb-4"},Object.keys(v.ROMS).map(function(e){return s.a.createElement(y.a,{key:e,to:"/run/"+encodeURIComponent(e),className:"list-group-item"},e,s.a.createElement("span",{className:"float-right"},"\u203a"))})),s.a.createElement("p",null,"Or, drag and drop a ROM file onto the page."))))}}]),t}(r.Component),C=(n(49),n(17)),k=n(34),B=n(31),T=n(11),O=n(3),E=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(m.a)(t).call(this,e))).state={playerOneButton:"",playerTwoButton:"",waitingForKey:0},n.handleClick=n.handleClick.bind(Object(T.a)(Object(T.a)(n))),n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.keys,t=this.props.button,n=[];for(var a in e)1===e[a][0]&&e[a][1]===t?(n[0]=e[a][2],console.log(n[0])):2===e[a][0]&&e[a][1]===t&&(n[1]=e[a][2]);this.setState({playerOneButton:n[0],playerTwoButton:n[1]})}},{key:"componentDidUpdate",value:function(e,t){var n,a,o=this.props.keys,r=this.props.button,s=[];for(var i in o)1===o[i][0]&&o[i][1]===r?(s[0]=o[i][2],console.log(s[0])):2===o[i][0]&&o[i][1]===r&&(s[1]=o[i][2]);var l=function(e,t){return e.buttons.filter(function(e){return e.buttonId===t})[0]},c=function(e,t){return t.buttons.filter(function(t){return!e||!e.buttons.some(function(e){return e.buttonId===t.buttonId})})[0]},u=0,p=0,m=function(e){return"button"===e.type?"Btn-"+e.code:"axis"===e.type?"Axis-"+e.code+" "+e.value:void 0};if(this.props.gamepadConfig&&this.props.gamepadConfig.playerGamepadId){var h=this.props.gamepadConfig.playerGamepadId;h[0]&&(s[0]="",n=l(this.props.gamepadConfig.configs[h[0]],r),a=c(e.gamepadConfig.configs[h[0]],this.props.gamepadConfig.configs[h[0]]),n?s[0]=m(n):a&&a.buttonId===this.props.prevButton&&(u||(u=1,p=1))),h[1]&&(s[1]="",n=l(this.props.gamepadConfig.configs[h[1]],r),a=c(e.gamepadConfig.configs[h[1]],this.props.gamepadConfig.configs[h[1]]),n?s[1]=m(n):a&&a.buttonId===this.props.prevButton&&(u||(u=2,p=2)))}var d={};u&&this.props.handleClick([p,this.props.button]),t.playerOneButton===s[0]&&t.playerTwoButton===s[1]||(d.playerOneButton=s[0],d.playerTwoButton=s[1]),u?d.waitingForKey=u:1===t.waitingForKey?this.props.currentPromptButton!==this.props.button&&(d.waitingForKey=0):2===t.waitingForKey&&this.props.currentPromptButton!==this.props.button&&(d.waitingForKey=0),Object.keys(d).length>0&&this.setState(d)}},{key:"handleClick",value:function(e){this.props.handleClick([e,this.props.button]),this.setState({waitingForKey:e})}},{key:"render",value:function(){var e=this;return s.a.createElement("tr",null,s.a.createElement("td",null,this.props.buttonName),s.a.createElement("td",{onClick:function(){return e.handleClick(1)}},1===this.state.waitingForKey?"Press key or button...":this.state.playerOneButton),s.a.createElement("td",{onClick:function(){return e.handleClick(2)}},2===this.state.waitingForKey?"Press key or button...":this.state.playerTwoButton))}}]),t}(r.Component),N="../img/nes_controller.png",U="../img/keyboard.png",S=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(m.a)(t).call(this,e))).state={gamepadConfig:e.gamepadConfig,keys:e.keys,button:void 0,modified:!1},n.handleKeyDown=n.handleKeyDown.bind(Object(T.a)(Object(T.a)(n))),n.handleGamepadButtonDown=n.handleGamepadButtonDown.bind(Object(T.a)(Object(T.a)(n))),n.listenForKey=n.listenForKey.bind(Object(T.a)(Object(T.a)(n))),n.state.gamepadConfig=n.state.gamepadConfig||{},n.state.gamepadConfig.playerGamepadId=n.state.gamepadConfig.playerGamepadId||[null,null],n.state.gamepadConfig.configs=n.state.gamepadConfig.configs||{},n.state.controllerIcon=n.state.gamepadConfig.playerGamepadId.map(function(e){return e?N:U}),n.state.controllerIconAlt=n.state.gamepadConfig.playerGamepadId.map(function(e){return e?"gamepad":"keyboard"}),n.state.currentPromptButton=-1,n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"componentWillUnmount",value:function(){this.state.modified&&(this.props.setKeys(this.state.keys),this.props.setGamepadConfig(this.state.gamepadConfig)),this.removeKeyListener()}},{key:"listenForKey",value:function(e){var t=e[1];this.removeKeyListener(),this.setState({button:e,currentPromptButton:t}),this.props.promptButton(this.handleGamepadButtonDown),document.addEventListener("keydown",this.handleKeyDown)}},{key:"handleGamepadButtonDown",value:function(e){this.removeKeyListener();var t=this.state.button,n=t[0],a=t[1],o=e.gamepadId,r=this.state.gamepadConfig,s=r.playerGamepadId.slice(0),i={};s[n-1]=o;var l={code:e.code,type:e.type,buttonId:a,value:e.value};i[o]={buttons:(r.configs[o]||{buttons:[]}).buttons.filter(function(e){return e.buttonId!==a}).concat([l])};var c=Object.assign({},r.configs,i);this.setState({gamepadConfig:{configs:c,playerGamepadId:s},currentPromptButton:-1,controllerIcon:s.map(function(e){return e?N:U}),modified:!0})}},{key:"handleKeyDown",value:function(e){this.removeKeyListener();var t=this.state.button,n=this.state.keys,a={};for(var o in n)n[o][0]===t[0]&&n[o][1]===t[1]||(a[o]=n[o]);var r=this.state.gamepadConfig.playerGamepadId.slice(0);r[t[0]-1]=null,this.setState({keys:Object(B.a)({},a,Object(C.a)({},e.keyCode,Object(k.a)(t.slice(0,2)).concat([e.key.length>1?e.key:String(e.key).toUpperCase()]))),button:void 0,gamepadConfig:{configs:this.state.gamepadConfig.configs,playerGamepadId:r},currentPromptButton:-1,controllerIcon:r.map(function(e){return e?N:U}),controllerIconAlt:r.map(function(e){return e?"gamepad":"keyboard"}),modified:!0})}},{key:"removeKeyListener",value:function(){this.props.promptButton(null),document.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){return s.a.createElement(b.c,{isOpen:this.props.isOpen,toggle:this.props.toggle,className:"ControlsModal"},s.a.createElement(b.f,{toggle:this.props.toggle},"Controls"),s.a.createElement(b.d,null,s.a.createElement(b.h,null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"Button"),s.a.createElement("th",null,"Player 1",s.a.createElement("img",{className:"controller-icon",src:this.state.controllerIcon[0],alt:this.state.controllerIconAlt[0]})),s.a.createElement("th",null,"Player 2",s.a.createElement("img",{className:"controller-icon",src:this.state.controllerIcon[1],alt:this.state.controllerIconAlt[1]})))),s.a.createElement("tbody",null,s.a.createElement(E,{buttonName:"Left",currentPromptButton:this.state.currentPromptButton,button:O.Controller.BUTTON_LEFT,prevButton:O.Controller.BUTTON_SELECT,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),s.a.createElement(E,{buttonName:"Right",currentPromptButton:this.state.currentPromptButton,button:O.Controller.BUTTON_RIGHT,prevButton:O.Controller.BUTTON_LEFT,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),s.a.createElement(E,{buttonName:"Up",currentPromptButton:this.state.currentPromptButton,button:O.Controller.BUTTON_UP,prevButton:O.Controller.BUTTON_RIGHT,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),s.a.createElement(E,{buttonName:"Down",currentPromptButton:this.state.currentPromptButton,button:O.Controller.BUTTON_DOWN,prevButton:O.Controller.BUTTON_UP,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),s.a.createElement(E,{buttonName:"A",currentPromptButton:this.state.currentPromptButton,button:O.Controller.BUTTON_A,prevButton:O.Controller.BUTTON_DOWN,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),s.a.createElement(E,{buttonName:"B",currentPromptButton:this.state.currentPromptButton,button:O.Controller.BUTTON_B,prevButton:O.Controller.BUTTON_A,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),s.a.createElement(E,{buttonName:"Start",currentPromptButton:this.state.currentPromptButton,button:O.Controller.BUTTON_START,prevButton:O.Controller.BUTTON_B,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig}),s.a.createElement(E,{buttonName:"Select",currentPromptButton:this.state.currentPromptButton,button:O.Controller.BUTTON_SELECT,prevButton:O.Controller.BUTTON_START,keys:this.state.keys,handleClick:this.listenForKey,gamepadConfig:this.state.gamepadConfig})))),s.a.createElement(b.e,null,s.a.createElement(b.a,{outline:!0,color:"primary",onClick:this.props.toggle},"Close")))}}]),t}(r.Component),I=function(){function e(t){var n=this;Object(c.a)(this,e),this.onAnimationFrame=function(){if(n.calibrating&&(null===n.calibrationStartTime?(n.calibrationStartTime=(new Date).getTime(),n.calibrationCurrentFrames=0):n.calibrationCurrentFrames+=1,n.calibrationCurrentFrames===n.calibrationFrames)){n.calibrating=!1;var e=1e3/(((new Date).getTime()-n.calibrationStartTime)/n.calibrationFrames);(e<=n.desiredFPS-n.calibrationTolerance||e>=n.desiredFPS+n.calibrationTolerance)&&(console.log("Enabling bodge mode. (Desired FPS is ".concat(n.desiredFPS,", actual FPS is ").concat(e,")")),n.startBodgeMode())}n.requestAnimationFrame(),n.running&&(n.bodgeMode||n.onGenerateFrame(),n.onWriteFrame())},this.startBodgeMode=function(){n.bodgeMode=!0,n.bodgeInterval=setInterval(n.onBodge,1e3/n.desiredFPS)},this.onBodge=function(){n.running&&n.onGenerateFrame()},this.onGenerateFrame=t.onGenerateFrame,this.onWriteFrame=t.onWriteFrame,this.running=!1,this.bodgeMode=!1,this.desiredFPS=60,this.calibrationDelay=200,this.calibrationFrames=10,this.calibrationTolerance=5,this.calibrating=!1,this.calibrationStartTime=null,this.calibrationCurrentFrames=null}return Object(u.a)(e,[{key:"start",value:function(){this.running=!0,this.requestAnimationFrame(),this.bodgeMode&&this.startBodgeMode()}},{key:"stop",value:function(){this.running=!1,this._requestID&&window.cancelAnimationFrame(this._requestID),this.bodgeInterval&&clearInterval(this.bodgeInterval)}},{key:"requestAnimationFrame",value:function(){this._requestID=window.requestAnimationFrame(this.onAnimationFrame)}}]),e}(),D={88:[1,O.Controller.BUTTON_A,"X"],89:[1,O.Controller.BUTTON_B,"Y"],90:[1,O.Controller.BUTTON_B,"Z"],17:[1,O.Controller.BUTTON_SELECT,"Right Ctrl"],13:[1,O.Controller.BUTTON_START,"Enter"],38:[1,O.Controller.BUTTON_UP,"Up"],40:[1,O.Controller.BUTTON_DOWN,"Down"],37:[1,O.Controller.BUTTON_LEFT,"Left"],39:[1,O.Controller.BUTTON_RIGHT,"Right"],103:[2,O.Controller.BUTTON_A,"Num-7"],105:[2,O.Controller.BUTTON_B,"Num-9"],99:[2,O.Controller.BUTTON_SELECT,"Num-3"],97:[2,O.Controller.BUTTON_START,"Num-1"],104:[2,O.Controller.BUTTON_UP,"Num-8"],98:[2,O.Controller.BUTTON_DOWN,"Num-2"],100:[2,O.Controller.BUTTON_LEFT,"Num-4"],102:[2,O.Controller.BUTTON_RIGHT,"Num-6"]},F=function e(t){var n=this;Object(c.a)(this,e),this.loadKeys=function(){var e;try{(e=localStorage.getItem("keys"))&&(e=JSON.parse(e))}catch(t){console.log("Failed to get keys from localStorage.",t)}n.keys=e||D},this.setKeys=function(e){try{localStorage.setItem("keys",JSON.stringify(e)),n.keys=e}catch(t){console.log("Failed to set keys in localStorage")}},this.handleKeyDown=function(e){var t=n.keys[e.keyCode];t&&(n.onButtonDown(t[0],t[1]),e.preventDefault())},this.handleKeyUp=function(e){var t=n.keys[e.keyCode];t&&(n.onButtonUp(t[0],t[1]),e.preventDefault())},this.handleKeyPress=function(e){e.preventDefault()},this.onButtonDown=t.onButtonDown,this.onButtonUp=t.onButtonUp},P=function e(t){var n=this;Object(c.a)(this,e),this.disableIfGamepadEnabled=function(e){var t=n;return function(n,a){if(!t.gamepadConfig)return e(n,a);var o=t.gamepadConfig.playerGamepadId;return o&&o[n-1]?void 0:e(n,a)}},this._getPlayerNumberFromGamepad=function(e){return n.gamepadConfig.playerGamepadId[0]===e.id?1:n.gamepadConfig.playerGamepadId[1]===e.id?2:1},this.poll=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads(),t=[],a=0;a<e.length;a++){var o=e[a],r=n.gamepadState[a];if(o)if(r){var s=o.buttons,i=r.buttons;if(n.buttonCallback){for(var l=0;l<o.axes.length;l++){var c=o.axes[l],u=r.axes[l];-1===c&&-1!==u&&n.buttonCallback({gamepadId:o.id,type:"axis",code:l,value:c}),1===c&&1!==u&&n.buttonCallback({gamepadId:o.id,type:"axis",code:l,value:c})}for(var p=0;p<s.length;p++){var m=s[p],h=i[p];m.pressed&&!h.pressed&&n.buttonCallback({gamepadId:o.id,type:"button",code:p})}}else if(n.gamepadConfig){var d=n._getPlayerNumberFromGamepad(o);if(t.length<2&&(-1!==t.indexOf(d)&&++d>2&&(d=1),t.push(d),n.gamepadConfig.configs[o.id]))for(var f=n.gamepadConfig.configs[o.id].buttons,g=0;g<f.length;g++){var b=f[g];if("button"===b.type){var y=b.code,v=s[y],w=i[y];v.pressed&&!w.pressed?n.onButtonDown(d,b.buttonId):!v.pressed&&w.pressed&&n.onButtonUp(d,b.buttonId)}else if("axis"===b.type){var C=b.code,k=o.axes[C],B=r.axes[C];k===b.value&&B!==b.value&&n.onButtonDown(d,b.buttonId),k!==b.value&&B===b.value&&n.onButtonUp(d,b.buttonId)}}}n.gamepadState[a]={buttons:s.map(function(e){return{pressed:e.pressed}}),axes:o.axes.slice(0)}}else n.gamepadState[a]=o}},this.promptButton=function(e){n.buttonCallback=e?function(t){n.buttonCallback=null,e(t)}:e},this.loadGamepadConfig=function(){var e;try{(e=localStorage.getItem("gamepadConfig"))&&(e=JSON.parse(e))}catch(t){console.log("Failed to get gamepadConfig from localStorage.",t)}n.gamepadConfig=e},this.setGamepadConfig=function(e){try{localStorage.setItem("gamepadConfig",JSON.stringify(e)),n.gamepadConfig=e}catch(t){console.log("Failed to set gamepadConfig in localStorage")}},this.startPolling=function(){var e;return e=requestAnimationFrame(function t(){n.poll(),e=requestAnimationFrame(t)}),{stop:function(){cancelAnimationFrame(e)}}},this.onButtonDown=t.onButtonDown,this.onButtonUp=t.onButtonUp,this.gamepadState=[],this.buttonCallback=null},x=(n(57),256),M=240,_=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(p.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(o)))).setBuffer=function(e){for(var t=0,a=0;a<M;++a)for(var o=0;o<x;++o)t=256*a+o,n.buf32[t]=4278190080|e[t]},n.writeBuffer=function(){n.imageData.data.set(n.buf8),n.context.putImageData(n.imageData,0,0)},n.fitInParent=function(){var e=n.canvas.parentNode,t=e.clientWidth,a=e.clientHeight,o=x/M;o<t/a?(n.canvas.style.width="".concat(Math.round(a*o),"px"),n.canvas.style.height="".concat(a,"px")):(n.canvas.style.width="".concat(t,"px"),n.canvas.style.height="".concat(Math.round(t/o),"px"))},n.handleMouseDown=function(e){if(n.props.onMouseDown){var t=x/parseFloat(n.canvas.style.width),a=n.canvas.getBoundingClientRect(),o=Math.round((e.clientX-a.left)*t),r=Math.round((e.clientY-a.top)*t);n.props.onMouseDown(o,r)}},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("canvas",{className:"Screen",width:x,height:M,onMouseDown:this.handleMouseDown,onMouseUp:this.props.onMouseUp,ref:function(t){e.canvas=t}})}},{key:"componentDidMount",value:function(){this.initCanvas()}},{key:"componentDidUpdate",value:function(){this.initCanvas()}},{key:"initCanvas",value:function(){this.context=this.canvas.getContext("2d"),this.imageData=this.context.getImageData(0,0,x,M),this.context.fillStyle="black",this.context.fillRect(0,0,x,M),this.buf=new ArrayBuffer(this.imageData.data.length),this.buf8=new Uint8ClampedArray(this.buf),this.buf32=new Uint32Array(this.buf);for(var e=0;e<this.buf32.length;++e)this.buf32[e]=4278190080}},{key:"screenshot",value:function(){var e=new Image;return e.src=this.canvas.toDataURL("image/png"),e}}]),t}(r.Component),j=n(32),G=n.n(j),A=function(e,t){console.error(e),o.a.captureException(e,{extra:t})},L=function(){function e(t){var n=this,a=t.onBufferUnderrun;Object(c.a)(this,e),this.writeSample=function(e,t){n.buffer.size()/2>=n.bufferSize&&console.log("Buffer overrun"),n.buffer.enq(e),n.buffer.enq(t)},this.onaudioprocess=function(e){var t=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1),o=t.length;n.buffer.size()<2*o&&n.onBufferUnderrun&&n.onBufferUnderrun(n.buffer.size(),2*o);try{var r=n.buffer.deqN(2*o)}catch(e){var s=n.buffer.size()/2;s>0&&console.log("Buffer underrun (needed ".concat(o,", got ").concat(s,")"));for(var i=0;i<o;i++)t[i]=0,a[i]=0;return}for(var l=0;l<o;l++)t[l]=r[2*l],a[l]=r[2*l+1]},this.onBufferUnderrun=a,this.bufferSize=8192,this.buffer=new G.a(2*this.bufferSize)}return Object(u.a)(e,[{key:"start",value:function(){window.AudioContext&&(this.audioCtx=new window.AudioContext,this.scriptNode=this.audioCtx.createScriptProcessor(1024,0,2),this.scriptNode.onaudioprocess=this.onaudioprocess,this.scriptNode.connect(this.audioCtx.destination))}},{key:"stop",value:function(){this.scriptNode&&(this.scriptNode.disconnect(this.audioCtx.destination),this.scriptNode.onaudioprocess=null,this.scriptNode=null),this.audioCtx&&(this.audioCtx.close().catch(A),this.audioCtx=null)}}]),e}();var K=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(m.a)(t).call(this,e))).load=function(){if(n.props.match.params.rom){var e=n.props.match.params.rom,t=v.ROMS[e];if(!t)return void n.setState({error:"No such ROM: ".concat(e)});n.currentRequest=function(e,t,n){var a=new XMLHttpRequest;return a.open("GET",e),a.overrideMimeType("text/plain; charset=x-user-defined"),a.onload=function(){200===this.status?t(null,this.responseText):0===this.status||t(new Error(a.statusText))},a.onerror=function(){t(new Error(a.statusText))},a.onprogress=n,a.send(),a}(t,function(e,t){e?window.alert("Error loading ROM: ".concat(e.toString())):n.handleLoaded(t)},n.handleProgress)}else if(n.props.location.state&&n.props.location.state.file){var a=new FileReader;a.readAsBinaryString(n.props.location.state.file),a.onload=function(e){n.currentRequest=null,n.handleLoaded(e.target.result)}}else window.alert("No ROM provided")},n.handleProgress=function(e){e.lengthComputable&&n.setState({loadedPercent:e.loaded/e.total*100})},n.handleLoaded=function(e){n.setState({uiEnabled:!0,running:!0,loading:!1}),n.nes.loadROM(e),n.start()},n.start=function(){n.frameTimer.start(),n.speakers.start(),n.fpsInterval=setInterval(function(){console.log("FPS: ".concat(n.nes.getFPS()))},1e3)},n.stop=function(){n.frameTimer.stop(),n.speakers.stop(),clearInterval(n.fpsInterval)},n.handlePauseResume=function(){n.state.paused?(n.setState({paused:!1}),n.start()):(n.setState({paused:!0}),n.stop())},n.layout=function(){var e=parseFloat(window.getComputedStyle(n.navbar).height);n.screenContainer.style.height="".concat(window.innerHeight-e,"px"),n.screen.fitInParent()},n.toggleControlsModal=function(){n.setState({controlsModal:!n.state.controlsModal})},n.state={running:!1,paused:!1,controlsModal:!1,loading:!0,loadedPercent:3,error:null},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"RunPage"},s.a.createElement("nav",{className:"navbar navbar-expand",ref:function(t){e.navbar=t}},s.a.createElement("ul",{className:"navbar-nav mr-auto"},s.a.createElement("li",{className:"navitem"},s.a.createElement(y.a,{to:"/",className:"nav-link"},"\u2039 Back"))),s.a.createElement(b.a,{outline:!0,color:"primary",onClick:this.toggleControlsModal,className:"mr-3"},"Controls"),s.a.createElement(b.a,{outline:!0,color:"primary",onClick:this.handlePauseResume,disabled:!this.state.running},this.state.paused?"Resume":"Pause")),this.state.error?this.state.error:s.a.createElement("div",{className:"screen-container",ref:function(t){e.screenContainer=t}},this.state.loading?s.a.createElement(b.g,{value:this.state.loadedPercent,style:{position:"absolute",width:"70%",left:"15%",top:"48%"}}):null,s.a.createElement(_,{ref:function(t){e.screen=t},onGenerateFrame:function(){e.nes.frame()},onMouseDown:function(t,n){e.nes.zapperMove(t,n),e.nes.zapperFireDown()},onMouseUp:function(){e.nes.zapperFireUp()}}),this.state.controlsModal&&s.a.createElement(S,{isOpen:this.state.controlsModal,toggle:this.toggleControlsModal,keys:this.keyboardController.keys,setKeys:this.keyboardController.setKeys,promptButton:this.gamepadController.promptButton,gamepadConfig:this.gamepadController.gamepadConfig,setGamepadConfig:this.gamepadController.setGamepadConfig})))}},{key:"componentDidMount",value:function(){var e=this;this.speakers=new L({onBufferUnderrun:function(t,n){e.state.running&&!e.state.paused&&(console.log("Buffer underrun, running another frame to try and catch up"),e.nes.frame(),e.speakers.buffer.size()<n&&(console.log("Still buffer underrun, running a second frame"),e.nes.frame()))}}),this.nes=new O.NES({onFrame:this.screen.setBuffer,onStatusUpdate:console.log,onAudioSample:this.speakers.writeSample}),window.nes=this.nes,this.frameTimer=new I({onGenerateFrame:o.a.wrap(this.nes.frame),onWriteFrame:o.a.wrap(this.screen.writeBuffer)}),this.gamepadController=new P({onButtonDown:this.nes.buttonDown,onButtonUp:this.nes.buttonUp}),this.gamepadController.loadGamepadConfig(),this.gamepadPolling=this.gamepadController.startPolling(),this.keyboardController=new F({onButtonDown:this.gamepadController.disableIfGamepadEnabled(this.nes.buttonDown),onButtonUp:this.gamepadController.disableIfGamepadEnabled(this.nes.buttonUp)}),this.keyboardController.loadKeys(),document.addEventListener("keydown",this.keyboardController.handleKeyDown),document.addEventListener("keyup",this.keyboardController.handleKeyUp),document.addEventListener("keypress",this.keyboardController.handleKeyPress),window.addEventListener("resize",this.layout),this.layout(),this.load()}},{key:"componentWillUnmount",value:function(){this.currentRequest&&this.currentRequest.abort(),this.stop(),document.removeEventListener("keydown",this.keyboardController.handleKeyDown),document.removeEventListener("keyup",this.keyboardController.handleKeyUp),document.removeEventListener("keypress",this.keyboardController.handleKeyPress),this.gamepadPolling.stop(),window.removeEventListener("resize",this.layout),window.nes=void 0}}]),t}(r.Component),R=(n(59),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(p.a)(this,Object(m.a)(t).call(this,e))).recordPageview=function(e){var t=e.location;return d.a.pageview(t.pathname),null},n.state={error:null},v.GOOGLE_ANALYTICS_CODE&&d.a.initialize(v.GOOGLE_ANALYTICS_CODE),n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return this.state.error?s.a.createElement("div",{className:"container my-4"},s.a.createElement("div",{className:"row justify-content-center"},s.a.createElement("div",{className:"col-md-8"},"Oops - there has been an error. It has been logged to the console."))):s.a.createElement(f.a,null,s.a.createElement("div",{className:"App"},s.a.createElement(g.a,{exact:!0,path:"/",component:w}),s.a.createElement(g.a,{exact:!0,path:"/run",component:K}),s.a.createElement(g.a,{exact:!0,path:"/run/:rom",component:K}),s.a.createElement(g.a,{path:"/",render:this.recordPageview})))}},{key:"componentDidCatch",value:function(e,t){this.setState({error:e}),A(e,t)}}]),t}(r.Component));n(62);v.SENTRY_URI&&o.a.config(v.SENTRY_URI).install(),o.a.context(function(){l.a.render(s.a.createElement(R,null),document.getElementById("root"))})}},[[35,2,1]]]);
//# sourceMappingURL=main.27af9f34.chunk.js.map